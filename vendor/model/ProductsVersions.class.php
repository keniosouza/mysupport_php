<?php/** * Classe ProductsVersions.class.php * @filesource * @autor        Kenio de Souza * @copyright    Copyright 2022 - Souza Consultoria Tecnológica * @package        vendor * @subpackage    model * @version        1.0 * @date            18/04/2022 *//** Defino o local onde esta a classe */namespace vendor\model;class ProductsVersions{    /** Declaro as vaiavéis da classe */    private $connection = null;    private $sql = null;    private $stmt = null;    private $start = null;    private $max = null;    private $field = null;    private $limit = null;    private $productVersionId = null;    private $productId = null;    private $description = null;    private $number = null;    private $history = null;    /** Construtor da classe */    function __construct()    {        /** Cria o objeto de conexão com o banco de dados */        $this->connection = new Mysql();    }    /** Carrega os campos de uma tabela */    public function Describe()    {        /** Consulta SQL */        $this->sql = "describe products_versions";        /** Preparo o SQL para execução */        $this->stmt = $this->connection->connect()->prepare($this->sql);        /** Executo o SQL */        $this->stmt->execute();        /** Retorno o resultado */        $this->field = $this->stmt->fetchAll(\PDO::FETCH_OBJ);        /** Declara o objeto */        $resultDescribe = new \stdClass();        $Field = '';        /** Lista os campos da tabela para objetos */        foreach ($this->field as $UsersKey => $Result) {            /** Pega o nome do Field/Campo */            $Field = $Result->Field;            /** Carrega os objetos como null */            $resultDescribe->$Field = null;        }        /** Retorna os campos declarados como vazios */        return $resultDescribe;    }    /** Lista os registros do banco de dados com limitação */    public function Get(int $productVersionId)    {        /** Parametros de entrada */        $this->productVersionId = $productVersionId;        /** Consulta SQL */        $this->sql = 'select pv.*,                             p.products_id,                             p.company_id,                             p.products_type_id,                             p.name                      from products_versions pv                      join products p on pv.product_id = p.products_id					  where pv.product_version_id = :product_version_id';        /** Preparo o SQL para execução */        $this->stmt = $this->connection->connect()->prepare($this->sql);        /** Preencho os parâmetros do SQL */        $this->stmt->bindParam(':product_version_id', $this->productVersionId);        /** Executo o SQL */        $this->stmt->execute();        /** Retorno o resultado */        return $this->stmt->fetchObject();    }    /** Lista os registros do banco de dados com limitação */    public function GetLast(int $productId)    {        /** Parametros de entrada */        $this->productId = $productId;        /** Consulta SQL */        $this->sql = 'select * from products_versions pv                      join products p on pv.product_id = p.products_id					  where pv.product_id = :productId					  order by pv.product_version_id desc					  limit 1';        /** Preparo o SQL para execução */        $this->stmt = $this->connection->connect()->prepare($this->sql);        /** Preencho os parâmetros do SQL */        $this->stmt->bindParam(':productId', $this->productId);        /** Executo o SQL */        $this->stmt->execute();        /** Retorno o resultado */        return $this->stmt->fetchObject();    }    /** Lista todos os egistros do banco com ou sem paginação*/    public function All(int $productId)    {        /** Parametros */        $this->productId = $productId;        /** Consulta SQL */        $this->sql = 'select * from products_versions pv                      join products p on pv.product_id = p.products_id                      where pv.product_id = :productId';        /** Preparo o SQL para execução */        $this->stmt = $this->connection->connect()->prepare($this->sql);        /** Preencho os parâmetros do SQL */        $this->stmt->bindParam('productId', $this->productId);        /** Executo o SQL */        $this->stmt->execute();        /** Retorno o resultado */        return $this->stmt->fetchAll(\PDO::FETCH_OBJ);    }    /** Insere um novo registro no banco */    public function Save(int $productVersionId, string $productId, string $description, string $number, string $history)    {        /** Parametros */        $this->productVersionId = $productVersionId;        $this->productId = $productId;        $this->description = $description;        $this->number = $number;        $this->history = $history;        /** Verifica se o ID do registro foi informado */        if ($this->productVersionId > 0) {            /** Consulta SQL */            $this->sql = 'update products_versions set product_id = :product_id,									   	     description = :description,									   	     number = :number,									   	     history = :history					  	  where product_version_id = :product_version_id';        } else {//Se o ID não foi informado, grava-se um novo registro            /** Consulta SQL */            $this->sql = 'insert into products_versions(product_version_id, 											  product_id, 											  description, 											  number, 											  history 								 	 ) values (:product_version_id, 									  		   :product_id,									  		   :description,									  		   :number,									  		   :history)';        }        /** Preparo o sql para receber os valores */        $this->stmt = $this->connection->connect()->prepare($this->sql);        /** Preencho os parâmetros do SQL */        $this->stmt->bindParam('product_version_id', $this->productVersionId);        $this->stmt->bindParam('product_id', $this->productId);        $this->stmt->bindParam('description', $this->description);        $this->stmt->bindParam('number', $this->number);        $this->stmt->bindParam('history', $this->history);        /** Executo o SQL */        return $this->stmt->execute();    }    /** Deleta um determinado registro no banco de dados */    function Delete(int $productVersionId)    {        /** Parametros de entrada */        $this->productVersionId = $productVersionId;        /** Consulta SQL */        $this->sql = 'delete from products_versions					  where  product_version_id = :product_version_id';        /** Preparo o sql para receber os valores */        $this->stmt = $this->connection->connect()->prepare($this->sql);        /** Preencho os parâmetros do SQL */        $this->stmt->bindParam('product_version_id', $this->productVersionId);        /** Executo o SQL */        return $this->stmt->execute();    }    /** Fecha uma conexão aberta anteriormente com o banco de dados */    function __destruct()    {        $this->connection = null;    }}